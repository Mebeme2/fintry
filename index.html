<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Robot AR Hospital</title>

<!-- Three.js core -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>

<!-- GLTF Loader -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

<!-- AR Button -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/webxr/ARButton.js"></script>

<style>
  body { margin: 0; overflow: hidden; background: #000; }
  #message {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    color: black;
    background: white;
    padding: 10px 20px;
    font-family: sans-serif;
    font-weight: bold;
    border-radius: 10px;
    display: none;
    z-index: 100;
  }
</style>
</head>

<body>
<div id="message">Medicine Delivered! âœ…</div>
<script>
let scene, camera, renderer;
let controller;
let robot, bed;
let delivered = false;

// Initialize scene
scene = new THREE.Scene();
camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 20);

renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.xr.enabled = true;
document.body.appendChild(renderer.domElement);
document.body.appendChild(ARButton.createButton(renderer));

// Lighting
const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
light.position.set(0.5, 1, 0.25);
scene.add(light);

// Load robot model
const loader = new THREE.GLTFLoader();
loader.load('robot.glb', function(gltf){
    robot = gltf.scene;
    robot.scale.set(0.5,0.5,0.5); // scale as needed
    robot.position.set(0,0,-1); // start 1m in front
    scene.add(robot);
});

// Create bed
const bedGeo = new THREE.BoxGeometry(0.5,0.2,0.5);
const bedMat = new THREE.MeshStandardMaterial({color:0xff5555});
bed = new THREE.Mesh(bedGeo, bedMat);
bed.position.set(0,0,-2); // 2m in front
scene.add(bed);

// Confetti particles
let confetti = [];
function spawnConfetti() {
    for(let i=0;i<50;i++){
        const geom = new THREE.SphereGeometry(0.02,8,8);
        const mat = new THREE.MeshStandardMaterial({color:Math.random()*0xffffff});
        const particle = new THREE.Mesh(geom, mat);
        particle.position.copy(robot.position);
        particle.velocity = new THREE.Vector3((Math.random()-0.5)*0.5, Math.random()*0.5, (Math.random()-0.5)*0.5);
        scene.add(particle);
        confetti.push(particle);
    }
}

// Controller (tap detection)
controller = renderer.xr.getController(0);
controller.addEventListener('select', ()=>{
    if(!robot || !bed) return;
    const distance = robot.position.distanceTo(bed.position);
    if(distance<0.6 && !delivered){
        document.getElementById('message').style.display='block';
        delivered = true;
        spawnConfetti();
        setTimeout(()=>document.getElementById('message').style.display='none',2000);
    }
});
scene.add(controller);

// Animate confetti
function updateConfetti(delta){
    confetti.forEach(p=>{
        p.position.add(p.velocity.clone().multiplyScalar(delta));
        p.velocity.y -= 0.98*delta; // gravity
        if(p.position.y <0) p.position.y=0;
    });
}

// Render loop
renderer.setAnimationLoop(function(){
    const delta = renderer.xr.isPresenting ? renderer.xr.getFrame().deltaTime || 0.016 : 0.016;
    updateConfetti(delta);
    renderer.render(scene,camera);
});

window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
